I"Ï9<p><em>ëª¨ë“  ë‚´ìš©ì€ MacOS Catalina ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</em></p>

<p><strong>await, async, _, args ë“± JavaScriptë‚´ìš©ì€ ë”°ë¡œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</strong></p>

<h2 id="1-nodemailer-ì„¤ì¹˜í•˜ê¸°">1. nodemailer ì„¤ì¹˜í•˜ê¸°</h2>

<p>nodemailerë¥¼ í™œìš©í•˜ì—¬ ë©”ì¼ì„ ë³´ë‚´ë´…ì‹œë‹¤.<br />
ë¨¼ì € nodemailerë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add nodemailer
</code></pre></div></div>

<p>nodemailerë¥¼ ì„¤ì¹˜í–ˆìœ¼ë©´ utils.jsì— ë©”ì¼ì— ë“¤ì–´ê°ˆ ë‚´ìš©ì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMail</span> <span class="o">=</span> <span class="nx">email</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">sendSecretMail</span> <span class="o">=</span> <span class="p">(</span><span class="nx">adress</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sbs@prismagram.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="nx">adress</span><span class="p">,</span>
        <span class="na">subject</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ğŸ”’Login Secret for PrismagramğŸ”’</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">html</span><span class="p">:</span> <span class="s2">`Hello Your login secret is </span><span class="p">${</span><span class="nx">secret</span><span class="p">}</span><span class="s2">. &lt;br/&gt; Copy paste on the app/website to login`</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="2-transport-ì„¤ì¹˜í•˜ê¸°">2. transport ì„¤ì¹˜í•˜ê¸°</h2>

<p>ê·¸ëŸ°ë°, ë©”ì¼ì„ ì „ì†¡í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” transportë¥¼ ì„¤ì¹˜í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ì¼ë‹¨ sendgridë¥¼ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.<br />
sendgridì—ì„œ íšŒì›ê°€ì…ì„ í•˜ê³  sendgrid transportë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add nodemailer-sendgrid-transport
</code></pre></div></div>
<p>utils.jsì— ë…¸ë“œë©”ì¼ëŸ¬ì™€ íŠ¸ëœìŠ¤í¬íŠ¸ë¥¼ import í•©ë‹ˆë‹¤.</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">nodemailer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">sgTransport</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer-sendgrid-transport</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>
<p>ê·¸ë¦¬ê³  export const sendMail = email =&gt; null;ì—ì„œ nullì„ ì§€ìš°ê³  api_userì™€ api_keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMail</span> <span class="o">=</span> <span class="nx">email</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">auth</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">api_user</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_USERNAME</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">api_key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_PASSWORD</span><span class="dl">'</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<p>í•¨ìˆ˜ì˜ ì¸ìë¡œëŠ” Sting íƒ€ì…ì˜ ì´ë©”ì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="w"> </span><span class="n">Mutation</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">requestSecret</span><span class="p">(</span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!):</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">!</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>js íŒŒì¼ì—ëŠ” async í•¨ìˆ˜ë¡œ requestSecret í•¨ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.<br />
ì²«ë²ˆì§¸ ì¸ìëŠ” í•„ìš”ì—†ê³ , ë‘ë²ˆì§¸ ì¸ìëŠ” argsë¼ê³  í•˜ê² ìŠµë‹ˆë‹¤.<br />
argsì—ì„œ emailì„ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
	<span class="na">Mutation</span><span class="p">:</span> <span class="p">{</span>
		<span class="na">requestSecret</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="kd">const</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>api í´ë” ë°”ê¹¥ì— ë¹„ë°€ê°’ì„ ìƒì„±í•  í•¨ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.</p>

<p>src/utils.js ë§Œë“ ë‹¤ìŒ ë‹¨ì–´ë“¤ì„ ì €ì¥í•  words.jsë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">adjectives</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">nouns</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div>

<p>utils.jsì—ëŠ” ê°’ë¥¼ ìƒì„±í•  í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ê³  ë‹¨ì–´ë¥¼ import í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">adjectives</span><span class="p">,</span> <span class="nx">nouns</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./words</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">genertateSecret</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">randomNumber</span> <span class="o">=</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>ì´ë•Œ ë¬´ì‘ìœ„ë¡œ ë‹¨ì–´ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤.<br />
í¬ë¡¬ ì½˜ì†”ì—ì„œ ë‹¨ì–´ë“¤ì„ ìƒì„±í•˜ê³  Math.random í•¨ìˆ˜ë¥¼ ì‹¤í–‰í™ë‹ˆë‹¤.<br />
Math.randomì€ 0ì—ì„œ 1ì‚¬ì´ì˜ ë¬´ì‘ìœ„ ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.<br />
ê·¸ëŸ¼ 0ê³¼ adjectivesì˜ ê¸¸ì´ ì‚¬ì´ì˜ ì„ì˜ì˜ ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">adjectives</span><span class="p">.</span><span class="nx">length</span>
</code></pre></div></div>

<p>ì´ë•Œ ì†Œìˆ«ì ì„ ë°˜ë‚´ë¦¼í•˜ëŠ” Math.floorë¥¼ ì¶”ê°€í•˜ì—¬ ì •ìˆ˜ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">adjectives</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</code></pre></div></div>

<p>ìœ„ì—ì„œ ë§Œë“  math í•¨ìˆ˜ë¥¼ utilsì— ì¶”ê°€í•˜ê³  ëœë¤í•œ ìˆ«ìë¥¼ ë°˜í™˜ë°›ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">adjectives</span><span class="p">,</span> <span class="nx">nouns</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./words</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">generateSecret</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">randomNumber</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">adjectives</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
	<span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">adjectives</span><span class="p">[</span><span class="nx">randomNumber</span><span class="p">]}</span><span class="s2"> </span><span class="p">${</span><span class="nx">nouns</span><span class="p">[</span><span class="nx">randomNumber</span><span class="p">]}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">};</span>

</code></pre></div></div>

<h2 id="2-í•¨ìˆ˜-ê²€ì¦í•˜ê¸°">2. í•¨ìˆ˜ ê²€ì¦í•˜ê¸°</h2>

<p>ì§€ê¸ˆê¹Œì§€ ë§Œë“  í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ì§€ì •ëœ ì´ë©”ì¼ë¡œ ë¹„ë°€ê°’ì„ ë°›ì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">generateSecret</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../utils</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">prisma</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../../generated/prisma-client</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
	<span class="na">Mutation</span><span class="p">:</span> <span class="p">{</span>
		<span class="na">requestSecret</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="kd">const</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
			<span class="kd">const</span> <span class="nx">loginSecret</span> <span class="o">=</span> <span class="nx">generateSecret</span><span class="p">();</span>
			<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">loginSecret</span><span class="p">);</span>
			<span class="k">try</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">prisma</span><span class="p">.</span><span class="nx">updateUser</span><span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="nx">loginSecret</span> <span class="p">},</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">}</span> <span class="p">});</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ í•˜ê³  localhostì—ì„œ mutationì„ ì‹¤í–‰ì‹œí‚¤ë©´</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mutation</span> <span class="p">{</span>
  <span class="nx">requestSecret</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span><span class="dl">"</span><span class="s2">k1a11220@naver.com</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>false ì—ëŸ¬ê°€ ë‚˜ì˜¤ëŠ”ë° ì´ê±´ datamodelì—ì„œ loginSecretì„ !(í•„ìˆ˜)ë¡œ í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>

<p>prismaì™€ graphql ëª¨ë‘ ë°”ê¿”ì¤ë‹ˆë‹¤.</p>
<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">loginSecret</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="k">type</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
	</span><span class="n">loginSecret</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>ê·¸ ë‹¤ìŒ mutationì„ ì‹¤í–‰ì‹œí‚¤ë©´ tureê°’ì´ ë°˜í™˜ë˜ê³  ì–´ë“œë¯¼ í˜ì´ì§€ì— ë“¤ì–´ê°€ì„œ ì‚´í´ë³´ë©´</p>

<p><img src="/assets/2020-03-27-prismagram-7/admin.png" alt="admin" /></p>

<p>loginSecretê°’ì´ ë“¤ì–´ì™€ìˆìŠµë‹ˆë‹¤.</p>
:ET