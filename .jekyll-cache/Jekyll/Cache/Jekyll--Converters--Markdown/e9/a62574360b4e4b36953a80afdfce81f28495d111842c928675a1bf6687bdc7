I"@<h2 id="1-ëª¨ë¸-ì„¤ê³„í•˜ê¸°">1. ëª¨ë¸ ì„¤ê³„í•˜ê¸°</h2>

<p>ê°„ë‹¨í•˜ê²Œ ë‚´ë¶€ ì²´ì ì„ êµ¬í•  ìˆ˜ ìˆëŠ” ê·¸ë¦‡ì„ ì„¤ê³„í•©ë‹ˆë‹¤.</p>

<p><img src="/assets/2020-04-26-solidworks-1/1.PNG" alt="ê·¸ë¦‡ ëª¨ë¸ë§" /></p>

<h2 id="2-ë¬¼ì„±ì¹˜-í™•ì¸í•˜ê¸°">2. ë¬¼ì„±ì¹˜ í™•ì¸í•˜ê¸°</h2>

<p>ê·¸ëŸ°ë°, ë©”ì¼ì„ ì „ì†¡í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” transportë¥¼ ì„¤ì¹˜í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ì¼ë‹¨ sendgridë¥¼ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.<br />
sendgridì—ì„œ íšŒì›ê°€ì…ì„ í•˜ê³  sendgrid transportë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add nodemailer-sendgrid-transport
</code></pre></div></div>

<p>utils.jsì— ë…¸ë“œë©”ì¼ëŸ¬ì™€ íŠ¸ëœìŠ¤í¬íŠ¸ë¥¼ import í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">nodemailer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">sgTransport</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer-sendgrid-transport</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  export const sendMail = email =&gt; null;ì—ì„œ nullì„ ì§€ìš°ê³  api_userì™€ api_keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMail</span> <span class="o">=</span> <span class="nx">email</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">auth</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">api_user</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_USERNAME</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">api_key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_PASSWORD</span><span class="dl">'</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  usernameê³¼ passwordëŠ” .envì— ì €ì¥í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SENDGRID_USERNAME</span><span class="o">=</span><span class="dl">"</span><span class="s2">ì‚¬ìš©ìì´ë¦„ ì…ë ¥</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">SENDGRID_PASSWORD</span><span class="o">=</span><span class="dl">"</span><span class="s2">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>server.jsì— utilsë¥¼ import í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">'</span><span class="s1">./utils</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>console.logë¡œ .env ìƒì˜ ë‚´ìš©ì„ í™•ì¸í•˜ë©´ undefinedë¡œ ì¶œë ¥ë˜ëŠ”ë° ì´ëŠ” serverì™€ utilì— ë™ì¼í•œ ë‚´ìš©ì„ import í•´ì£¼ë©´ í•´ê²°ë©ë‹ˆë‹¤.</p>

<p>utils.js</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">dotenv</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">path</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span> <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.env</span><span class="dl">'</span><span class="p">)</span> <span class="p">});</span>
</code></pre></div></div>

<h2 id="3-ë©”ì¼-ì „ì†¡ë˜ëŠ”ì§€-í…ŒìŠ¤íŠ¸í•´ë³´ê¸°">3. ë©”ì¼ ì „ì†¡ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³´ê¸°</h2>

<p>sendSecretmailì€ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë¯€ë¡œ exportë¥¼ ì§€ì›ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">sendSecretMail</span> <span class="o">=</span> <span class="p">(</span><span class="nx">adress</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sbs@prismagram.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="nx">adress</span><span class="p">,</span>
        <span class="na">subject</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ğŸ”’Login Secret for PrismagramğŸ”’</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">html</span><span class="p">:</span> <span class="s2">`Hello Your login secret is </span><span class="p">${</span><span class="nx">secret</span><span class="p">}</span><span class="s2">. &lt;br/&gt; Copy paste on the app/website to login`</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<p>server.jsì— í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œë´…ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">sendSecretMail</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./utils</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">sendSecretMail</span><span class="p">(</span><span class="dl">'</span><span class="s1">k1a11220@naver.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>ê·¸ëŸ°ë°, sendgridê°€ ê³„ì •ìŠ¹ì¸ì„ ì•ˆí•´ì¤˜ì„œ mailgunìœ¼ë¡œ ë°”ê¾¸ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ì´ìŠˆ">ì´ìŠˆ</h2>

<p>yarn dev í• ë•Œ í¬íŠ¸ ì¤‘ë³µì´ë¼ê³  ì˜¤ë¥˜ê°€ ë‚˜ì˜µë‹ˆë‹¤</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">events</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">298</span>
      <span class="k">throw</span> <span class="nx">er</span><span class="p">;</span> <span class="c1">// Unhandled 'error' event</span>
      <span class="o">^</span>

<span class="nb">Error</span><span class="p">:</span> <span class="nx">listen</span> <span class="nx">EADDRINUSE</span><span class="p">:</span> <span class="nx">address</span> <span class="nx">already</span> <span class="k">in</span> <span class="nx">use</span> <span class="p">:::</span><span class="mi">4000</span>
    <span class="nx">at</span> <span class="nx">Server</span><span class="p">.</span><span class="nx">setupListenHandle</span> <span class="p">[</span><span class="k">as</span> <span class="nx">_listen2</span><span class="p">]</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1309</span><span class="p">:</span><span class="mi">16</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">listenInCluster</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1357</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1445</span><span class="p">:</span><span class="mi">7</span><span class="p">)</span>
    <span class="nx">at</span> <span class="o">/</span><span class="nx">Users</span><span class="o">/</span><span class="nx">beomsoo</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">GitHub</span><span class="o">/</span><span class="nx">prismagram</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">graphql</span><span class="o">-</span><span class="nx">yoga</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">ts</span><span class="p">:</span><span class="mi">391</span><span class="p">:</span><span class="mi">22</span>
    <span class="nx">at</span> <span class="k">new</span> <span class="nb">Promise</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">anonymous</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">GraphQLServer</span><span class="p">.</span><span class="nx">start</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">beomsoo</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">GitHub</span><span class="o">/</span><span class="nx">prismagram</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">graphql</span><span class="o">-</span><span class="nx">yoga</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">ts</span><span class="p">:</span><span class="mi">389</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nb">Object</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">anonymous</span><span class="o">&gt;</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">beomsoo</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">GitHub</span><span class="o">/</span><span class="nx">prismagram</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">server</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">_compile</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">modules</span><span class="o">/</span><span class="nx">cjs</span><span class="o">/</span><span class="nx">loader</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1157</span><span class="p">:</span><span class="mi">30</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">_compile</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">beomsoo</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">GitHub</span><span class="o">/</span><span class="nx">prismagram</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">pirates</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">99</span><span class="p">:</span><span class="mi">24</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">_extensions</span><span class="p">..</span><span class="nx">js</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">modules</span><span class="o">/</span><span class="nx">cjs</span><span class="o">/</span><span class="nx">loader</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1177</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<span class="nx">Emitted</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span> <span class="nx">event</span> <span class="nx">on</span> <span class="nx">WebSocketServer</span> <span class="nx">instance</span> <span class="nx">at</span><span class="p">:</span>
    <span class="nx">at</span> <span class="nx">Server</span><span class="p">.</span><span class="nx">emit</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">321</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Server</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">.</span><span class="nx">emit</span> <span class="p">(</span><span class="nx">domain</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">482</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">emitErrorNT</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">1336</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">processTicksAndRejections</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">process</span><span class="o">/</span><span class="nx">task_queues</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="mi">21</span><span class="p">)</span> <span class="p">{</span>
  <span class="nl">code</span><span class="p">:</span> <span class="dl">'</span><span class="s1">EADDRINUSE</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">errno</span><span class="p">:</span> <span class="dl">'</span><span class="s1">EADDRINUSE</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">syscall</span><span class="p">:</span> <span class="dl">'</span><span class="s1">listen</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">address</span><span class="p">:</span> <span class="dl">'</span><span class="s1">::</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">port</span><span class="p">:</span> <span class="mi">4000</span>
<span class="p">}</span>
</code></pre></div></div>

<p>nodemonì— â€“delay 2së¥¼ ì¶”ê°€í•˜ê±°ë‚˜ í¬íŠ¸ê°’ì„ ë³€ê²½í•´ë„ ë™ì¼í•˜ê²Œ ì˜¤ë¥˜ê°€ ë‚˜ì˜µë‹ˆë‹¤.
ë”°ë¼ì„œ ê·¸ëƒ¥ server.jsì— ì‹œì‘í¬íŠ¸ë¥¼ ì…ë ¥í•´ì¤ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="na">port</span><span class="p">:</span> <span class="mi">4000</span> <span class="p">},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server running on port http://localhost:</span><span class="p">${</span><span class="nx">PORT</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
</code></pre></div></div>
:ET