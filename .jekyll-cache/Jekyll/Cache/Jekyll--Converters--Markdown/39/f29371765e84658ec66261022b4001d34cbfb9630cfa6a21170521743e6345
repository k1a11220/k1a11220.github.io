I"<p><em>ëª¨ë“  ë‚´ìš©ì€ MacOS Catalina ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</em></p>

<p><strong>await, async, _, args ë“± JavaScriptë‚´ìš©ì€ ë”°ë¡œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</strong></p>

<h2 id="1-nodemailer-ì„¤ì¹˜í•˜ê¸°">1. nodemailer ì„¤ì¹˜í•˜ê¸°</h2>

<p>nodemailerë¥¼ í™œìš©í•˜ì—¬ ë©”ì¼ì„ ë³´ë‚´ë´…ì‹œë‹¤.<br />
ë¨¼ì € nodemailerë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add nodemailer
</code></pre></div></div>

<p>nodemailerë¥¼ ì„¤ì¹˜í–ˆìœ¼ë©´ utils.jsì— ë©”ì¼ì— ë“¤ì–´ê°ˆ ë‚´ìš©ì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMail</span> <span class="o">=</span> <span class="nx">email</span> <span class="o">=&gt;</span> <span class="kc">null</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">sendSecretMail</span> <span class="o">=</span> <span class="p">(</span><span class="nx">adress</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sbs@prismagram.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="nx">adress</span><span class="p">,</span>
        <span class="na">subject</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ğŸ”’Login Secret for PrismagramğŸ”’</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">html</span><span class="p">:</span> <span class="s2">`Hello Your login secret is </span><span class="p">${</span><span class="nx">secret</span><span class="p">}</span><span class="s2">. &lt;br/&gt; Copy paste on the app/website to login`</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="2-transport-ì„¤ì¹˜í•˜ê¸°">2. transport ì„¤ì¹˜í•˜ê¸°</h2>

<p>ê·¸ëŸ°ë°, ë©”ì¼ì„ ì „ì†¡í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” transportë¥¼ ì„¤ì¹˜í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ì¼ë‹¨ sendgridë¥¼ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.<br />
sendgridì—ì„œ íšŒì›ê°€ì…ì„ í•˜ê³  sendgrid transportë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add nodemailer-sendgrid-transport
</code></pre></div></div>

<p>utils.jsì— ë…¸ë“œë©”ì¼ëŸ¬ì™€ íŠ¸ëœìŠ¤í¬íŠ¸ë¥¼ import í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">nodemailer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">sgTransport</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">nodemailer-sendgrid-transport</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  export const sendMail = email =&gt; null;ì—ì„œ nullì„ ì§€ìš°ê³  api_userì™€ api_keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMail</span> <span class="o">=</span> <span class="nx">email</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">auth</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">api_user</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_USERNAME</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">api_key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENDGRID_PASSWORD</span><span class="dl">'</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  usernameê³¼ passwordëŠ” .envì— ì €ì¥í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">SENDGRID_USERNAME</span><span class="o">=</span><span class="dl">"</span><span class="s2">ì‚¬ìš©ìì´ë¦„ ì…ë ¥</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">SENDGRID_PASSWORD</span><span class="o">=</span><span class="dl">"</span><span class="s2">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>server.jsì— utilsë¥¼ import í•©ë‹ˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">'</span><span class="s1">./utils</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>console.logë¡œ .env ìƒì˜ ë‚´ìš©ì„ í™•ì¸í•˜ë©´ undefinedë¡œ ì¶œë ¥ë˜ëŠ”ë° ì´ëŠ” serverì™€ utilì— ë™ì¼í•œ ë‚´ìš©ì„ import í•´ì£¼ë©´ í•´ê²°ë©ë‹ˆë‹¤.</p>

<p>utils.js</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">dotenv</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">path</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span> <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.env</span><span class="dl">'</span><span class="p">)</span> <span class="p">});</span>
</code></pre></div></div>

<h2 id="ì´ìŠˆ">ì´ìŠˆ</h2>

<p>yarn dev í• ë•Œ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>events.js:298
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::4000
    at Server.setupListenHandle [as _listen2] (net.js:1309:16)
    at listenInCluster (net.js:1357:12)
    at Server.listen (net.js:1445:7)
    at /Users/beomsoo/Documents/GitHub/prismagram/node_modules/graphql-yoga/src/index.ts:391:22
    at new Promise (&lt;anonymous&gt;)
    at GraphQLServer.start (/Users/beomsoo/Documents/GitHub/prismagram/node_modules/graphql-yoga/src/index.ts:389:12)
    at Object.&lt;anonymous&gt; (/Users/beomsoo/Documents/GitHub/prismagram/src/server.js:16:8)
    at Module._compile (internal/modules/cjs/loader.js:1157:30)
    at Module._compile (/Users/beomsoo/Documents/GitHub/prismagram/node_modules/pirates/lib/index.js:99:24)
    at Module._extensions..js (internal/modules/cjs/loader.js:1177:10)
Emitted 'error' event on WebSocketServer instance at:
    at Server.emit (events.js:321:20)
    at Server.EventEmitter.emit (domain.js:482:12)
    at emitErrorNT (net.js:1336:8)
    at processTicksAndRejections (internal/process/task_queues.js:84:21) {
  code: 'EADDRINUSE',
  errno: 'EADDRINUSE',
  syscall: 'listen',
  address: '::',
  port: 4000
}
</code></pre></div></div>

:ET